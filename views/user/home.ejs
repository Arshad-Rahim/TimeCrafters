
		<%-include('../../views/partials/user/header',{user})  %>
		<head>
			<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
			<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		</head>
		<style>

.indian-rupee::before {
        content: "\20B9"; /* Unicode for Indian Rupee symbol */
        font-family: Arial, sans-serif;
        margin-right: 2px;
        font-weight: 300; /* Light font weight */
        color: #666; /* Lighter color */
    }

.regular-price {
  font-size: 14px;
  color: #666;
  text-decoration: line-through;
  margin-right: 10px;
}

.sale-price {
  font-size: 18px;
  color: #333;
  font-weight: bold;
}	

  /* Updated modal styles to match the design */
  .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        padding: 24px;
        border-radius: 16px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .modal-content h2 {
        font-size: 24px;
        font-weight: bold;
        margin: 0 0 20px 0;
        color: #000;
    }

    .modal-input {
        width: 100%;
        padding: 12px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 16px;
    }

    .modal-input::placeholder {
        color: #a0aec0;
    }

    .modal-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }

    .modal-button {
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: none;
    }

    .skip-button {
        background-color: #f7fafc;
        color: #4a5568;
    }

    .apply-button {
        background-color: #000;
        color: white;
    }

		</style>


	<!-- Slider -->
	<section class="section-slide">
		<div class="wrap-slick1">
			<div class="slick1">
				<div class="item-slick1" style="background-image: url(frontend/images/banner3.png);">
					<div class="container h-full">
						<div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
							<div class="layer-slick1 animated visible-false" data-appear="fadeInDown" data-delay="0">
								<span class="ltext-101 cl2 respon2">
									Women Collection 2024
								</span>
							</div>
								
							<div class="layer-slick1 animated visible-false" data-appear="fadeInUp" data-delay="800">
								<h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
									NEW SEASON
								</h2>
							</div>
								
							<div class="layer-slick1 animated visible-false" data-appear="zoomIn" data-delay="1600">
								<a href="/product" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
									Shop Now
								</a>
							</div>
						</div>
					</div>
				</div>

				<div class="item-slick1" style="background-image: url(frontend/images/banner4.jpeg);">
					<div class="container h-full">
						<div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
							<div class="layer-slick1 animated visible-false" data-appear="rollIn" data-delay="0">
								<span class="ltext-101 cl2 respon2">
									Men New-Season
								</span>
							</div>
								
							<div class="layer-slick1 animated visible-false" data-appear="lightSpeedIn" data-delay="800">
								<h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
									Watches
								</h2>
							</div>
								
							<div class="layer-slick1 animated visible-false" data-appear="slideInUp" data-delay="1600">
								<a href="product.html" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
									Shop Now
								</a>
							</div>
						</div>
					</div>
				</div>

				<div class="item-slick1" style="background-image: url(frontend/images/banner5.jpeg);">
					<div class="container h-full">
						<div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
							<div class="layer-slick1 animated visible-false" data-appear="rotateInDownLeft" data-delay="0">
								<span class="ltext-101 cl2 respon2">
									Men Collection 2024
								</span>
							</div>
								
							<div class="layer-slick1 animated visible-false" data-appear="rotateInUpRight" data-delay="800">
								<h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
									New arrivals
								</h2>
							</div>
								
							<div class="layer-slick1 animated visible-false" data-appear="rotateIn" data-delay="1600">
								<a href="product.html" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
									Shop Now
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>


	<!-- Banner -->
	<div class="sec-banner bg0 p-t-80 p-b-50">
		<div class="container">
			<div class="row">
				<div class="col-md-6 col-xl-4 p-b-30 m-lr-auto">
					<!-- Block1 -->
					<div class="block1 wrap-pic-w">
						<img src="frontend/images/banner-01.jpg" alt="IMG-BANNER">

						<a href="/userProductList/67080a92f0d40130b0b14290" class="block1-txt ab-t-l s-full flex-col-l-sb p-lr-38 p-tb-34 trans-03 respon3">
							<div class="block1-txt-child1 flex-col-l">
								<span class="block1-name ltext-102 trans-04 p-b-8">
									Women
								</span>

								<span class="block1-info stext-102 trans-04">
									Spring 2024
								</span>
							</div>

							<div class="block1-txt-child2 p-b-4 trans-05">
								<div class="block1-link stext-101 cl0 trans-09">
									Shop Now
								</div>
							</div>
						</a>
					</div>
				</div>

				<div class="col-md-6 col-xl-4 p-b-30 m-lr-auto">
					<!-- Block1 -->
					<div class="block1 wrap-pic-w">
						<img src="frontend/images/banner-02.jpg" alt="IMG-BANNER">

						<a href="/userProductList/671389c6dd3b5fffd40ebeb3" class="block1-txt ab-t-l s-full flex-col-l-sb p-lr-38 p-tb-34 trans-03 respon3">
							<div class="block1-txt-child1 flex-col-l">
								<span class="block1-name ltext-102 trans-04 p-b-8">
									Men
								</span>

								<span class="block1-info stext-102 trans-04">
									Spring 2024
								</span>
							</div>

							<div class="block1-txt-child2 p-b-4 trans-05">
								<div class="block1-link stext-101 cl0 trans-09">
									Shop Now
								</div>
							</div>
						</a>
					</div>
				</div>

				<div class="col-md-6 col-xl-4 p-b-30 m-lr-auto">
					<!-- Block1 -->
					<div class="block1 wrap-pic-w">
						<img src="frontend/images/luxurybanner.jpeg" alt="IMG-BANNER">

						<a href="/userProductList/67080abff0d40130b0b14297" class="block1-txt ab-t-l s-full flex-col-l-sb p-lr-38 p-tb-34 trans-03 respon3">
							<div class="block1-txt-child1 flex-col-l">
								<span class="block1-name ltext-102 trans-04 p-b-8">
									Luxury
								</span>

								<span class="block1-info stext-102 trans-04">
									Expensive Watches
								</span>
							</div>

							<div class="block1-txt-child2 p-b-4 trans-05">
								<div class="block1-link stext-101 cl0 trans-09">
									Shop Now
								</div>
							</div>
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- Product -->
	<section id="body" class="bg0 p-t-23 p-b-140">
		<div class="container">
			<div class="p-b-10">
				<h3 class="ltext-103 cl5">
					Product Overview
				</h3>
			</div>

			

			<div class="row isotope-grid">
				<!-- product[i].category.name -->
				<% for(let i=0;i<product.length;i++){  %>
				<div class="col-sm-6 col-md-4 col-lg-3 p-b-35 isotope-item women">
					<!-- Block2 -->
					<div class="block2">
						<div class="block2-txt-child2 flex-r p-t-3">
							<button onclick="wishlist(event,'<%= product[i]._id %>')" class="btn-addwish-b2 dis-block pos-relative ">
                                <% 
        let isInWishlist = false;
        // Check if wishlist exists and has a wishlist property
        if (wishlist && wishlist.wishlist) {
            isInWishlist = wishlist.wishlist.some(item => product[i]._id.toString() === item.productId.toString());
        }
        %>
        <% if (isInWishlist) { %>
            <img src="/frontend/images/icons/icon-heart-02.png" alt="ICON">
        <% } else { %>
            <img class="icon-heart1 dis-block trans-04" src="/frontend/images/icons/icon-heart-01.png" alt="ICON">
            <img class="icon-heart2 dis-block trans-04 ab-t-l" src="/frontend/images/icons/icon-heart-02.png" alt="ICON">
        <% } %>
							</button>
						</div>
						<div class="block2-pic hov-img0">
							<img src="/uploads/re-image/<%= product[i].productImage[0] %>" alt="<%= product[i].productName  %>">
							<a href="/productDetails/<%= product[i]._id %>" class="block2-btn flex-c-m stext-103 cl2 size-102 bg0 bor2 hov-btn1 p-lr-15 trans-04 ">
								Product View
							</a>
						</div>

						<div class="block2-txt flex-w flex-t p-t-14">
							<div class="block2-txt-child1 flex-col-l ">
								<a href="/productDetails/<%= product[i]._id %>" class="stext-104 cl4 hov-cl1 trans-04 js-name-b2 p-b-6">
									<%= product[i].productName %>
								</a>

								<!-- <span class="stext-105 cl3">
									Rs: <%= product[i].salePrice %>
								</span> -->

								<span class="mtext-106 cl2">
									<del class="regular-price"><span class="indian-rupee"></span><%= product[i].regularPrice %></del>
									<span class="sale-price"><span class="indian-rupee"></span><%= product[i].salePrice %></span>
								  </span>
							</div>

							
							
						</div>
						
					</div>
				</div>

				<% } %>
			</div>

<% if(user){ %>
	<% if(!user.appliedReferalCode){ %>
			<div id="referralModal" class="modal">
				<div class="modal-content">
					<h2>Enter Referral Code</h2>
					<input type="text" id="referralCode" class="modal-input" placeholder="Enter your referral code">
					<div class="modal-buttons">
						<button id="skipReferral" class="modal-button skip-button">Skip</button>
						<button id="applyReferral" class="modal-button apply-button">Apply</button>
					</div>
				</div>
			</div>

		<% } } %>	

		
		</div>
	</section>


    <%-include('../../views/partials/user/footer')  %>

	<script>

		function wishlist(event,productId){
		
			event.preventDefault();
			$.ajax({
        url:`/wishlist/${productId}`,
        type:'POST',
        dataType:'json',
        contentType:'application/json',

        success:function(response){
            if(response.success){
                Swal.fire({
                    toast:true,
                    position:'center',
                    icon:'success',
                    title:response.message,
                    showConfirmButton:false,
                    timer:1500,
                    customClass:'center-toast',

                })
                $('#body').load('/ #body')
            }
        },
        error:function(xhr,status,error){
            const response = xhr.responseJSON;
            Swal.fire({
                toast: true,
                position: 'center',
                icon: 'error',
                title: 'Error',
                text:response.message,
                showConfirmButton: false,
                timer: 1500,
                customClass: 'center-toast',
            });
        }
    })
		}
	</script>






<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById("referralModal");
        const applyButton = document.getElementById("applyReferral");
        const skipButton = document.getElementById("skipReferral");
        const referralInput = document.getElementById("referralCode");

        // Show modal when page loads
        modal.style.display = "flex";

        // Function to hide modal
        function hideModal() {
            modal.style.display = "none";
            referralInput.value = '';
        }

        // Skip button handler
        skipButton.addEventListener('click', function() {
			const referralCode = 'skip';
			$.ajax({
                url: '/applyReferral',
                type: 'POST',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({ referralCode }),
			})
            hideModal();
        });

        // Close modal if clicked outside
        window.onclick = function(event) {
            if (event.target == modal) {
                hideModal();
            }
        }

        // Apply referral code handler
        applyButton.addEventListener('click', function() {
            const referralCode = referralInput.value.trim();
            
            // Validate referral code
            if (!referralCode) {
                Swal.fire({
                    toast: true,
                    position: 'center',
                    icon: 'error',
                    title: 'Error',
                    text: 'Please enter a referral code',
                    showConfirmButton: false,
                    timer: 1500,
                    customClass: 'center-toast',
                });
                return;
            }

            // Send AJAX request
            $.ajax({
                url: '/applyReferral',
                type: 'POST',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({ referralCode }),
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            toast: true,
                            position: 'center',
                            icon: 'success',
                            title: response.message,
                            showConfirmButton: false,
                            timer: 1500,
                            customClass: 'center-toast',
                        });
                        hideModal();
                    }
                },
                error: function(xhr, status, error) {
                    const response = xhr.responseJSON;
                    Swal.fire({
                        toast: true,
                        position: 'center',
                        icon: 'error',
                        title: 'Error',
                        text: response.message,
                        showConfirmButton: false,
                        timer: 1500,
                        customClass: 'center-toast',
                    });
                }
            });
        });

        // Optional: Basic input validation
        referralInput.addEventListener('input', function() {
            // Remove spaces and convert to uppercase
            this.value = this.value.replace(/\s/g, '').toUpperCase();
        });
    });
</script>